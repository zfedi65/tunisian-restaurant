<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Tunisia Bites ‚Äî Single Page Restaurant</title>
<style>
  :root{
    --bg:#0f1724; --card:#0b1220; --accent:#e76f51; --muted:#9aa4b2; --glass: rgba(255,255,255,0.04);
    --success:#2dd4bf; --danger:#ff6b6b; --font-sans: "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; font-family:var(--font-sans); background:
      linear-gradient(180deg, rgba(231,111,81,0.06), rgba(0,0,0,0.06)),
      radial-gradient(600px 200px at 10% 10%, rgba(231,111,81,0.03), transparent 10%),
      var(--bg); color:#e6eef6; -webkit-font-smoothing:antialiased;
    padding:24px;
  }

  /* Layout */
  .container{max-width:1100px; margin:0 auto; display:grid; grid-template-columns: 1fr 360px; gap:20px; align-items:start;}
  header{grid-column:1/-1; display:flex; align-items:center; justify-content:space-between; gap:12px; margin-bottom:8px}
  h1{font-size:20px; margin:0; display:flex; align-items:center; gap:12px}
  .logo-badge{background:linear-gradient(135deg,var(--accent),#f4a261); width:44px; height:44px; border-radius:10px; display:grid;place-items:center; color:#fff; font-weight:700; box-shadow:0 6px 18px rgba(231,111,81,0.14)}
  .top-controls{display:flex; gap:8px; align-items:center}

  /* Card */
  .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); border-radius:12px; padding:16px; box-shadow:0 6px 20px rgba(2,6,23,0.6); border:1px solid rgba(255,255,255,0.03)}

  /* Menu area */
  .menu-wrap{min-height:400px}
  .controls{display:flex; gap:8px; margin-bottom:12px; flex-wrap:wrap}
  .search{flex:1; min-width:160px}
  input[type="search"], select, input[type="text"], input[type="email"], input[type="password"]{
    width:100%; padding:10px 12px; border-radius:10px; border:1px solid rgba(255,255,255,0.04); background:var(--glass); color:inherit;
  }
  .categories{display:flex; gap:8px; flex-wrap:wrap}
  .cat-btn{padding:8px 10px; border-radius:999px; background:transparent; border:1px solid rgba(255,255,255,0.03); cursor:pointer; color:var(--muted)}
  .cat-btn.active{background:rgba(231,111,81,0.12); color:var(--accent); border-color:rgba(231,111,81,0.18)}

  /* Grid of items */
  .grid{display:grid; grid-template-columns: repeat(auto-fill,minmax(230px,1fr)); gap:12px}
  .dish{display:flex; gap:12px; align-items:stretch; padding:12px; border-radius:10px; background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.02)); border:1px solid rgba(255,255,255,0.02)}
  .dish .thumb{width:88px; height:88px; border-radius:10px; background:linear-gradient(135deg,#fca311, #ff7b00); display:grid; place-items:center; font-weight:700; font-size:18px; color:#081424}
  .dish .meta{flex:1; display:flex; flex-direction:column; justify-content:space-between}
  .dish h3{margin:0; font-size:16px}
  .dish p{margin:4px 0 0; color:var(--muted); font-size:13px}
  .price-row{display:flex; justify-content:space-between; align-items:center; margin-top:8px}
  .add-btn{background:var(--accent); border:0; padding:8px 10px; color:#081424; font-weight:700; border-radius:8px; cursor:pointer}

  /* Sidebar cart */
  .sidebar .section-title{display:flex; justify-content:space-between; align-items:center; gap:8px}
  .cart-list{margin-top:10px; display:flex; flex-direction:column; gap:8px; max-height:420px; overflow:auto; padding-right:6px}
  .cart-item{display:flex; gap:10px; align-items:center; padding:8px; border-radius:8px; background:rgba(255,255,255,0.02)}
  .qty{display:flex; gap:6px; align-items:center}
  .qty button{padding:6px 8px; border-radius:6px; border:1px solid rgba(255,255,255,0.03); background:transparent; cursor:pointer}
  .muted{color:var(--muted); font-size:13px}

  /* signup modal-ish */
  .auth{display:flex; gap:8px; align-items:center}
  .auth button{padding:8px 10px; border-radius:8px; border:0; background:transparent; color:var(--muted); cursor:pointer}
  .auth .primary{background:rgba(231,111,81,0.12); color:var(--accent); border:1px solid rgba(231,111,81,0.18)}

  /* footer actions */
  .summary{margin-top:12px; display:grid; gap:8px}
  .big-btn{padding:10px 12px; border-radius:10px; border:0; font-weight:700; cursor:pointer}
  .checkout{background:linear-gradient(90deg,var(--accent),#f4a261); color:#081424}
  .clear{background:transparent; border:1px solid rgba(255,255,255,0.04); color:var(--muted)}

  /* small helpers */
  .tiny{font-size:12px;color:var(--muted)}
  .center{display:grid; place-items:center}
  .order-card{margin-top:12px; border-radius:10px; padding:10px; background:rgba(255,255,255,0.02); border:1px solid rgba(255,255,255,0.02)}
  pre{white-space:pre-wrap; word-break:break-word; background:transparent; font-family:inherit}
  /* Responsive */
  @media (max-width:980px){
    .container{grid-template-columns:1fr; padding-bottom:40px}
    .sidebar{order:2}
  }
</style>
</head>
<body>
  <div class="container">
    <header>
      <h1><div class="logo-badge">TB</div> Tunisia Bites <span class="tiny muted">‚Äî authentic flavors, delivered</span></h1>
      <div class="top-controls">
        <div class="auth card" id="authCard" style="padding:8px 10px; display:flex; gap:8px; align-items:center;">
          <div id="greeting" class="muted tiny">Welcome visitor</div>
          <button id="signupBtn" class="primary">Sign up</button>
          <button id="logoutBtn" style="display:none;" class="clear">Log out</button>
        </div>
      </div>
    </header>

    <!-- left: menu -->
    <main class="card menu-wrap">
      <div class="controls">
        <input id="search" class="search" type="search" placeholder="Search dishes (e.g. couscous, brik...)" />
        <select id="categorySelect" style="width:160px">
          <option value="all">All categories</option>
        </select>
        <div style="flex:1"></div>
        <button id="viewOrdersBtn" class="cat-btn">My Orders</button>
      </div>

      <div class="categories" id="categoryButtons" aria-hidden="false" style="margin-bottom:12px"></div>

      <div class="grid card" id="menuGrid" style="padding:12px"></div>

      <div style="margin-top:12px" class="tiny muted center">
        Demo site: Sign up (client-only) to place orders ‚Äî data saved locally in your browser.
      </div>
    </main>

    <!-- right: cart & signup -->
    <aside class="sidebar">
      <div class="card">
        <div class="section-title">
          <div>
            <div class="muted tiny">Your Cart</div>
            <strong id="cartCount">0 items</strong>
          </div>
          <div class="tiny muted">Currency: <strong>TND</strong></div>
        </div>

        <div class="cart-list" id="cartList">
          <div class="muted tiny center">Cart is empty ‚Äî add delicious Tunisian dishes!</div>
        </div>

        <div class="summary">
          <div style="display:flex; justify-content:space-between"><div class="tiny muted">Subtotal</div><div id="subtotal">0.00 TND</div></div>
          <div style="display:flex; justify-content:space-between"><div class="tiny muted">Tax (7%)</div><div id="taxAmt">0.00 TND</div></div>
          <div style="display:flex; justify-content:space-between"><div class="tiny muted">Delivery</div><div>
            <label><input type="checkbox" id="deliveryToggle" /> Add 1.5 TND</label>
          </div></div>
          <div style="display:flex; justify-content:space-between; font-weight:700; font-size:16px"><div>Total</div><div id="totalAmt">0.00 TND</div></div>

          <div style="display:flex; gap:8px; margin-top:6px">
            <button id="checkoutBtn" class="big-btn checkout" style="flex:1">Place order</button>
            <button id="clearCartBtn" class="big-btn clear">Clear</button>
          </div>

          <div style="margin-top:10px">
            <details>
              <summary class="tiny muted">Signup / account (demo)</summary>
              <div style="margin-top:8px; display:grid; gap:8px">
                <input id="nameInput" placeholder="Full name" />
                <input id="emailInput" type="email" placeholder="Email" />
                <input id="passwordInput" type="password" placeholder="Password (demo only)" />
                <div style="display:flex; gap:8px">
                  <button id="createAccount" class="big-btn primary" style="background:var(--accent); color:#081424; border:0; flex:1">Create account</button>
                  <button id="loginBtn" class="big-btn clear" style="flex:1">Log in</button>
                </div>
                <div class="tiny muted">Accounts saved locally in your browser for demo purposes only.</div>
              </div>
            </details>
          </div>
        </div>
      </div>

      <div id="ordersPanel" class="card" style="margin-top:12px; display:none">
        <div class="section-title"><strong>My Orders</strong><button id="closeOrders" class="cat-btn">Close</button></div>
        <div id="ordersList" style="margin-top:8px"></div>
      </div>

      <div id="confirmation" style="display:none" class="card order-card">
        <div id="confText"></div>
      </div>
    </aside>
  </div>

<script>
/* -------------------------
   Data: menu items
   ------------------------- */
const TAX_RATE = 0.07;
const DELIVERY_FEE = 1.5;

const menu = [
  {id:'couscous','name':'Couscous Royal','category':'Main','price':14.00,'desc':'Traditional semolina with meat, vegetables & spicy broth.'},
  {id:'brik','name':'Brik √† l\'oeuf','category':'Starters','price':3.50,'desc':'Crispy pastry with egg, tuna and parsley.'},
  {id:'lablabi','name':'Lablabi','category':'Main','price':4.50,'desc':'Chickpea soup with harissa and olive oil.'},
  {id:'mechouia','name':'Salade Mechouia','category':'Salads','price':5.00,'desc':'Grilled pepper & tomato salad with tuna and olives.'},
  {id:'tajine','name':'Tunisian Tajine','category':'Main','price':8.50,'desc':'Baked custardy omelette with meat and cheese.'},
  {id:'minttea','name':'Mint Tea','category':'Drinks','price':1.50,'desc':'Fresh mint tea ‚Äî perfect to finish a meal.'},
  {id:'makroudh','name':'Makroud','category':'Dessert','price':2.00,'desc':'Date-filled semolina pastry, lightly fried.'},
  {id:'grilledfish','name':'Grilled Fish (Poisson Grill√©)','category':'Main','price':12.50,'desc':'Daily catch, grilled and lightly seasoned.'},
  {id:'oliveplat','name':'Assiette d\'Olives & Fromage','category':'Starters','price':6.00,'desc':'Selection of local olives, cheese & bread.'}
];

/* -------------------------
   State
   ------------------------- */
let cart = {}; // id -> qty
let currentUser = null; // {name,email}
const STORAGE_USER_KEY = 'tunis_bites_user';
const STORAGE_ORDERS_KEY = 'tunis_bites_orders';

/* -------------------------
   Utility
   ------------------------- */
const $ = (sel,root=document)=>root.querySelector(sel);
const $$ = (sel,root=document)=>Array.from(root.querySelectorAll(sel));
const fmt = n => Number(n).toFixed(2) + ' TND';
const uuid = ()=> Math.random().toString(36).slice(2,9);

/* -------------------------
   Init UI
   ------------------------- */
function init(){
  // categories
  const cats = ['All', ...Array.from(new Set(menu.map(m=>m.category)))];
  const catButtons = $('#categoryButtons');
  const catSelect = $('#categorySelect');
  cats.forEach(c=>{
    const lc = c.toLowerCase();
    const btn = document.createElement('button');
    btn.textContent = c;
    btn.className = 'cat-btn';
    btn.dataset.cat = c;
    btn.addEventListener('click', ()=>{ selectCategory(c); });
    catButtons.appendChild(btn);

    const opt = document.createElement('option');
    opt.value = c.toLowerCase();
    opt.textContent = c;
    catSelect.appendChild(opt);
  });

  // event handlers
  $('#search').addEventListener('input', renderMenu);
  $('#categorySelect').addEventListener('change', ()=>selectCategory($('#categorySelect').value));
  $('#clearCartBtn').addEventListener('click', clearCart);
  $('#checkoutBtn').addEventListener('click', placeOrder);
  $('#deliveryToggle').addEventListener('change', updateCartUI);
  $('#createAccount').addEventListener('click', handleCreateAccount);
  $('#loginBtn').addEventListener('click', handleLogin);
  $('#signupBtn').addEventListener('click', ()=>{ window.scrollTo({top:document.body.scrollHeight, behavior:'smooth'}); $('#nameInput').focus(); });
  $('#logoutBtn').addEventListener('click', ()=>{ logout(); });
  $('#viewOrdersBtn').addEventListener('click', showOrdersPanel);
  $('#closeOrders').addEventListener('click', ()=>$('#ordersPanel').style.display='none');

  // persist login if present
  const storedUser = localStorage.getItem(STORAGE_USER_KEY);
  if(storedUser){ currentUser = JSON.parse(storedUser); updateAuthUI(); }

  renderMenu();
  updateCartUI();
}

/* -------------------------
   Menu rendering
   ------------------------- */
let selectedCategory = 'all';
function selectCategory(cat){
  selectedCategory = (cat || 'all').toLowerCase();
  // highlight buttons
  $$('.cat-btn').forEach(b=>{
    if(b.dataset.cat && b.dataset.cat.toLowerCase()===selectedCategory) b.classList.add('active');
    else b.classList.remove('active');
  });
  $('#categorySelect').value = selectedCategory;
  renderMenu();
}

function renderMenu(){
  const q = $('#search').value.trim().toLowerCase();
  const grid = $('#menuGrid');
  grid.innerHTML = '';
  let filtered = menu.filter(m=>{
    if(selectedCategory && selectedCategory!=='all' && m.category.toLowerCase() !== selectedCategory) return false;
    if(q && !(m.name.toLowerCase().includes(q) || m.desc.toLowerCase().includes(q) || m.category.toLowerCase().includes(q))) return false;
    return true;
  });

  if(filtered.length === 0){
    grid.innerHTML = '<div class="muted tiny center" style="padding:20px">No dishes match your search.</div>';
    return;
  }

  filtered.forEach(item=>{
    const d = document.createElement('div'); d.className='dish';
    d.innerHTML = `
      <div class="thumb" aria-hidden="true">${emojiFor(item.category)}</div>
      <div class="meta">
        <div>
          <h3>${escapeHtml(item.name)}</h3>
          <p class="muted">${escapeHtml(item.desc)}</p>
        </div>
        <div class="price-row">
          <div class="muted tiny">${item.category}</div>
          <div style="display:flex; gap:8px; align-items:center">
            <div style="font-weight:700">${formatPrice(item.price)}</div>
            <button class="add-btn" data-id="${item.id}">Add</button>
          </div>
        </div>
      </div>
    `;
    grid.appendChild(d);
  });

  // attach add listeners
  $$('.add-btn', grid).forEach(b=>{
    b.addEventListener('click', ()=>{ addToCart(b.dataset.id); });
  });
}

function emojiFor(cat){
  const map = {
    'Main':'üç≤','Starters':'ü•ü','Salads':'ü•ó','Drinks':'‚òï','Dessert':'üç∞'
  };
  return map[cat] || 'üçΩ';
}

/* -------------------------
   Cart management
   ------------------------- */
function addToCart(id, qty=1){
  cart[id] = (cart[id]||0) + Number(qty);
  updateCartUI();
}

function removeFromCart(id){
  delete cart[id];
  updateCartUI();
}

function changeQty(id, qty){
  if(qty<=0) removeFromCart(id);
  else cart[id] = qty;
  updateCartUI();
}

function clearCart(){
  cart = {};
  updateCartUI();
}

function computeTotals(){
  let subtotal = 0;
  Object.entries(cart).forEach(([id,qty])=>{
    const item = menu.find(m=>m.id===id);
    if(item) subtotal += item.price * qty;
  });
  const tax = subtotal * TAX_RATE;
  const delivery = $('#deliveryToggle').checked ? DELIVERY_FEE : 0;
  const total = subtotal + tax + delivery;
  return {subtotal, tax, delivery, total};
}

function updateCartUI(){
  const list = $('#cartList');
  list.innerHTML = '';
  const keys = Object.keys(cart);
  if(keys.length === 0){
    list.innerHTML = '<div class="muted tiny center">Cart is empty ‚Äî add delicious Tunisian dishes!</div>';
  } else {
    keys.forEach(id=>{
      const item = menu.find(m=>m.id===id);
      const qty = cart[id];
      const row = document.createElement('div'); row.className='cart-item';
      row.innerHTML = `
        <div style="width:44px; height:44px; border-radius:8px; background:linear-gradient(135deg,#ffd166,#fca311); display:grid;place-items:center; font-weight:700">${emojiFor(item.category)}</div>
        <div style="flex:1">
          <div style="display:flex; justify-content:space-between; gap:10px; align-items:center">
            <div><strong>${escapeHtml(item.name)}</strong><div class="muted tiny">${formatPrice(item.price)} each</div></div>
            <div style="text-align:right">${formatPrice(item.price*qty)}</div>
          </div>
          <div style="display:flex; justify-content:space-between; margin-top:8px; align-items:center">
            <div class="qty">
              <button class="dec" data-id="${id}">‚àí</button>
              <div class="muted tiny" style="min-width:26px; text-align:center">${qty}</div>
              <button class="inc" data-id="${id}">+</button>
            </div>
            <button class="clear remove" data-id="${id}" title="Remove">Remove</button>
          </div>
        </div>
      `;
      list.appendChild(row);
    });

    // attach handlers
    $$('.inc', list).forEach(b=>b.addEventListener('click', ()=>{ changeQty(b.dataset.id, (cart[b.dataset.id]||0)+1); }));
    $$('.dec', list).forEach(b=>b.addEventListener('click', ()=>{ changeQty(b.dataset.id, (cart[b.dataset.id]||0)-1); }));
    $$('.remove', list).forEach(b=>b.addEventListener('click', ()=>{ removeFromCart(b.dataset.id); }));
  }

  const totals = computeTotals();
  $('#subtotal').textContent = formatPrice(totals.subtotal);
  $('#taxAmt').textContent = formatPrice(totals.tax);
  $('#totalAmt').textContent = formatPrice(totals.total);
  $('#cartCount').textContent = `${Object.values(cart).reduce((a,b)=>a+b,0)} items`;
}

/* -------------------------
   Orders & signup
   ------------------------- */
function handleCreateAccount(){
  const name = $('#nameInput').value.trim();
  const email = $('#emailInput').value.trim().toLowerCase();
  const pw = $('#passwordInput').value;
  if(!name || !email || !pw){ alert('Please provide name, email and password to create an account.'); return; }
  const user = {id: uuid(), name, email};
  // store demo-only (no real security)
  localStorage.setItem(STORAGE_USER_KEY, JSON.stringify(user));
  currentUser = user;
  updateAuthUI();
  alert('Account created (demo). You are now signed in.');
}

function handleLogin(){
  const email = $('#emailInput').value.trim().toLowerCase();
  if(!email){ alert('Enter the email you used when creating your demo account.'); return; }
  const stored = localStorage.getItem(STORAGE_USER_KEY);
  if(!stored){ alert('No demo account found. Create one first.'); return; }
  const user = JSON.parse(stored);
  if(user.email !== email){ alert('Email does not match the stored demo account.'); return; }
  currentUser = user;
  updateAuthUI();
  alert('Logged in (demo).');
}

function logout(){
  currentUser = null;
  localStorage.removeItem(STORAGE_USER_KEY);
  updateAuthUI();
  alert('You have been logged out (demo).');
}

function updateAuthUI(){
  if(currentUser){
    $('#greeting').textContent = `Hello, ${currentUser.name}`;
    $('#signupBtn').style.display = 'none';
    $('#logoutBtn').style.display = 'inline-block';
    $('#nameInput').value = currentUser.name;
    $('#emailInput').value = currentUser.email;
  } else {
    $('#greeting').textContent = 'Welcome visitor';
    $('#signupBtn').style.display = 'inline-block';
    $('#logoutBtn').style.display = 'none';
  }
}

/* Place order */
function placeOrder(){
  if(Object.keys(cart).length === 0){ alert('Your cart is empty. Add some dishes!'); return; }
  if(!currentUser){
    if(!confirm('You are not signed in. Create a demo account to save your order in your browser?')) return;
    // if user agrees, attempt to create account from fields
    const name = $('#nameInput').value.trim();
    const email = $('#emailInput').value.trim().toLowerCase();
    if(!name || !email){ alert('Please fill name and email in the account area to continue.'); return; }
    currentUser = { id: uuid(), name, email };
    localStorage.setItem(STORAGE_USER_KEY, JSON.stringify(currentUser));
    updateAuthUI();
  }

  const totals = computeTotals();
  const order = {
    id: 'ORD-' + Date.now().toString(36).toUpperCase(),
    userId: currentUser.id,
    userName: currentUser.name,
    items: Object.entries(cart).map(([id,qty])=>{
      const itm = menu.find(m=>m.id===id);
      return {id, name: itm.name, price: itm.price, qty, lineTotal: itm.price * qty};
    }),
    totals,
    createdAt: new Date().toISOString(),
    status: 'Received'
  };

  // save into localStorage orders
  const stored = JSON.parse(localStorage.getItem(STORAGE_ORDERS_KEY) || '[]');
  stored.push(order);
  localStorage.setItem(STORAGE_ORDERS_KEY, JSON.stringify(stored));

  // feedback
  cart = {};
  updateCartUI();
  showConfirmation(order);
}

function showConfirmation(order){
  $('#ordersPanel').style.display='none';
  $('#confirmation').style.display='block';
  $('#confText').innerHTML = `
    <strong>Order ${escapeHtml(order.id)} received!</strong>
    <div class="muted tiny">Thanks ${escapeHtml(order.userName)} ‚Äî we saved your order locally in this browser.</div>
    <div style="margin-top:8px">
      <div class="muted tiny">Placed:</div>
      <div>${(new Date(order.createdAt)).toLocaleString()}</div>
      <div style="margin-top:8px" class="muted tiny">Items:</div>
      <ul>
        ${order.items.map(i=>`<li>${escapeHtml(i.qty + ' √ó ' + i.name)} ‚Äî ${formatPrice(i.lineTotal)}</li>`).join('')}
      </ul>
      <div style="margin-top:8px"><strong>Total: ${formatPrice(order.totals.total)}</strong></div>
    </div>
  `;
  // show recent orders after confirm
  setTimeout(()=> showOrdersPanel(), 600);
}

/* Order history panel */
function showOrdersPanel(){
  const panel = $('#ordersPanel');
  const list = $('#ordersList');
  panel.style.display = 'block';
  list.innerHTML = '';
  const all = JSON.parse(localStorage.getItem(STORAGE_ORDERS_KEY) || '[]');
  const userOrders = currentUser ? all.filter(o=>o.userId === currentUser.id) : all;
  if(userOrders.length === 0){
    list.innerHTML = '<div class="muted tiny center" style="padding:12px">No orders placed yet.</div>';
    return;
  }
  userOrders.slice().reverse().forEach(o=>{
    const el = document.createElement('div'); el.className='order-card';
    el.innerHTML = `
      <div style="display:flex; justify-content:space-between; align-items:center">
        <div><strong>${escapeHtml(o.id)}</strong><div class="muted tiny">${(new Date(o.createdAt)).toLocaleString()}</div></div>
        <div style="text-align:right"><div><strong>${formatPrice(o.totals.total)}</strong></div><div class="tiny muted">${escapeHtml(o.status)}</div></div>
      </div>
      <div style="margin-top:8px" class="muted tiny">${o.items.map(i=>escapeHtml(i.qty + '√ó ' + i.name)).join(' ‚Ä¢ ')}</div>
    `;
    list.appendChild(el);
  });
}

/* -------------------------
   Helpers: small safety & formatting
   ------------------------- */
function escapeHtml(s){ return String(s).replace(/[&<>"']/g, c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c])); }
function formatPrice(n){ return Number((Math.round(n*100)/100)).toFixed(2) + ' TND'; }

/* -------------------------
   Boot
   ------------------------- */
init();

</script>
</body>
</html>
